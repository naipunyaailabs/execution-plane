# Architecture Diagrams

## System Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         CLIENT LAYER                                     │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    React Frontend (TypeScript)                    │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │  │
│  │  │ Agent        │  │ Workflow     │  │ Monitoring   │          │  │
│  │  │ Builder      │  │ Builder      │  │ Dashboard    │          │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │  │
│  │  │ Agent Chat    │  │ Workflow     │  │ Analytics    │          │  │
│  │  │ Interface     │  │ Execution    │  │ & Reports    │          │  │
│  │  └──────────────┘  │ Monitor       │  └──────────────┘          │  │
│  │                    └──────────────┘                              │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ HTTP/REST + WebSocket
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         API LAYER                                        │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    FastAPI Backend (Python)                       │  │
│  │  ┌──────────────────────────────────────────────────────────┐  │  │
│  │  │                    API Routes (v1)                          │  │  │
│  │  │  /api/v1/agents          /api/v1/workflows                  │  │  │
│  │  │  /api/v1/monitoring      /api/v1/knowledge-bases            │  │  │
│  │  └──────────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         SERVICE LAYER                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │
│  │ Agent        │  │ Workflow     │  │ Monitoring   │                │
│  │ Service      │  │ Service      │  │ Service      │                │
│  └──────────────┘  └──────────────┘  └──────────────┘                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │
│  │ Tools        │  │ Knowledge    │  │ Memory       │                │
│  │ Service      │  │ Base Service │  │ Service      │                │
│  └──────────────┘  └──────────────┘  └──────────────┘                │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         EXECUTION LAYER                                  │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    LangGraph Agent Runtime                        │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │  │
│  │  │ ReAct        │  │ Plan-Execute │  │ Reflection  │          │  │
│  │  │ Agents       │  │ Agents       │  │ Agents       │          │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │  │
│  │  │ Custom        │  │ Tool         │  │ Memory       │          │  │
│  │  │ Agents        │  │ Integration  │  │ Integration  │          │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         DATA LAYER                                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │
│  │ SQLite/      │  │ Qdrant       │  │ External     │                │
│  │ PostgreSQL   │  │ Vector DB    │  │ APIs         │                │
│  │ (Metadata)   │  │ (Embeddings) │  │ (LLMs/Tools) │                │
│  └──────────────┘  └──────────────┘  └──────────────┘                │
└─────────────────────────────────────────────────────────────────────────┘
```

## Agent Execution Flow

```
User Input
    │
    ▼
┌─────────────────┐
│ Agent Service   │
│ - Get Agent     │
│ - Decrypt API   │
│   Key           │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ PII Filtering   │
│ (if configured) │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Memory Service   │
│ - Search Memory  │
│ - Get Context    │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Knowledge Base  │
│ Service         │
│ - Query KB      │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Tools Service   │
│ - Load Tools    │
│ - Configure     │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ LangGraph Agent │
│ - Create Graph  │
│ - Execute       │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ LLM Provider    │
│ (OpenAI, etc.)  │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Response        │
│ - PII Filter    │
│ - Store Memory  │
└─────────────────┘
    │
    ▼
User Output
```

## Workflow Execution Flow

```
Workflow Execution Request
    │
    ▼
┌─────────────────┐
│ Parse Workflow  │
│ Definition      │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Build Dependency│
│ Graph (DAG)     │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Identify        │
│ Starting Steps  │
│ (no deps)       │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Execute Ready   │
│ Steps in        │
│ Parallel        │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Update Context  │
│ with Results    │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ Evaluate        │
│ Conditions      │
└─────────────────┘
    │
    ▼
┌─────────────────┐
│ More Steps?     │───Yes───┐
└─────────────────┘        │
    │                      │
    No                     │
    │                      │
    ▼                      │
┌─────────────────┐        │
│ Complete        │        │
│ Workflow        │        │
└─────────────────┘        │
                            │
                            │
                            ▼
                    ┌─────────────────┐
                    │ Find Next Ready │
                    │ Steps           │
                    └─────────────────┘
                            │
                            │
                            └──────────────┘
```

## Data Flow Diagram

```
┌──────────────┐
│   Frontend   │
│   (React)    │
└──────┬───────┘
       │
       │ HTTP/REST
       │
       ▼
┌──────────────┐
│   FastAPI    │
│   Router     │
└──────┬───────┘
       │
       ├─────────────────┬─────────────────┬──────────────┐
       │                 │                 │              │
       ▼                 ▼                 ▼              ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│   Agent      │ │  Workflow    │ │  Monitoring  │ │  Knowledge  │
│   Service    │ │  Service     │ │  Service     │ │  Base        │
└──────┬───────┘ └──────┬───────┘ └──────┬───────┘ │  Service     │
       │                │                 │         └──────┬───────┘
       │                │                 │                │
       ▼                ▼                 ▼                ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│   Database   │ │  LangGraph   │ │  Metrics DB   │ │  Qdrant      │
│   (SQLite)   │ │  Runtime     │ │  (SQLite)     │ │  (Vector)    │
└──────────────┘ └──────┬───────┘ └───────────────┘ └──────────────┘
                        │
                        ▼
                ┌──────────────┐
                │  LLM APIs    │
                │  (External)  │
                └──────────────┘
```

## Component Interaction Diagram

```
┌─────────────────────────────────────────────────────────────┐
│                    Frontend Components                        │
│                                                               │
│  AgentBuilder ──┐                                            │
│                 │                                            │
│  AgentChat ─────┼───► API Calls ──► Backend API            │
│                 │                                            │
│  WorkflowBuilder┘                                            │
│                                                               │
│  WorkflowExecutionMonitor ──► WebSocket ──► Backend          │
└─────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────┐
│                    Backend Services                           │
│                                                               │
│  AgentService ──────┐                                         │
│                    │                                         │
│  WorkflowService ──┼───► Database (SQLAlchemy)              │
│                    │                                         │
│  MonitoringService ┘                                         │
│                                                               │
│  ToolsService ──────► External Tools (APIs)                  │
│                                                               │
│  MemoryService ─────► Qdrant + Mem0                          │
│                                                               │
│  KnowledgeBaseService ──► Qdrant (Vector Search)             │
└─────────────────────────────────────────────────────────────┘
```

## Security Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Security Layers                           │
│                                                               │
│  ┌─────────────────────────────────────────────────────┐  │
│  │  Layer 1: API Key Encryption                         │  │
│  │  - Fernet symmetric encryption                      │  │
│  │  - Keys stored encrypted in database                 │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                               │
│  ┌─────────────────────────────────────────────────────┐  │
│  │  Layer 2: PII Filtering Middleware                   │  │
│  │  - Input/Output filtering                           │  │
│  │  - Multiple strategies (redact, mask, hash, block) │  │
│  │  - Custom PII categories                            │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                               │
│  ┌─────────────────────────────────────────────────────┐  │
│  │  Layer 3: CORS Protection                            │  │
│  │  - Restricted origins                               │  │
│  │  - Configurable via settings                        │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                               │
│  ┌─────────────────────────────────────────────────────┐  │
│  │  Layer 4: Input Validation                           │  │
│  │  - Pydantic models                                   │  │
│  │  - Request/Response validation                       │  │
│  └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## Monitoring Architecture

```
┌─────────────────────────────────────────────────────────────┐
│              Monitoring & Observability                      │
│                                                               │
│  ┌─────────────────────────────────────────────────────┐  │
│  │  Real-Time Metrics Collection                        │  │
│  │  - CPU, Memory, I/O, Network                         │  │
│  │  - Execution time tracking                          │  │
│  │  - Step-level metrics                               │  │
│  └─────────────────────────────────────────────────────┘  │
│                    │                                        │
│                    ▼                                        │
│  ┌─────────────────────────────────────────────────────┐  │
│  │  Metrics Storage                                     │  │
│  │  - WorkflowExecution table                          │  │
│  │  - StepExecution table                              │  │
│  │  - ExecutionLog table                               │  │
│  └─────────────────────────────────────────────────────┘  │
│                    │                                        │
│                    ▼                                        │
│  ┌─────────────────────────────────────────────────────┐  │
│  │  Analytics Services                                  │  │
│  │  - Performance bottleneck detection                  │  │
│  │  - Failure analysis                                 │  │
│  │  - Resource usage trends                             │  │
│  │  - Predictive analytics                             │  │
│  └─────────────────────────────────────────────────────┘  │
│                    │                                        │
│                    ▼                                        │
│  ┌─────────────────────────────────────────────────────┐  │
│  │  API Endpoints                                       │  │
│  │  - /api/v1/monitoring/*                             │  │
│  │  - /api/v1/enhanced-monitoring/*                    │  │
│  └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

